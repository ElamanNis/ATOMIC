<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Smart Wellhead Control Center v5.0</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #0b0f19; --card: #161b2a; --text: #e2e8f0; --accent: #00d2ff; --warn: #facc15; --crit: #ff4b2b; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; margin: 0; padding: 20px; }
        .dashboard-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px; }
        .card { background: var(--card); padding: 20px; border-radius: 12px; border: 1px solid #232a3d; transition: 0.3s; }
        .card:hover { border-color: var(--accent); }
        .sensor-val { font-size: 24px; font-weight: bold; color: var(--accent); }
        .status-badge { padding: 4px 10px; border-radius: 20px; font-size: 12px; text-transform: uppercase; }
        .status-ok { background: #064e3b; color: #34d399; }
        .main-layout { display: grid; grid-template-columns: 3fr 1fr; gap: 20px; }
        .chart-container { background: var(--card); padding: 20px; border-radius: 12px; height: 400px; }
        .log-container { background: var(--card); padding: 20px; border-radius: 12px; height: 400px; overflow-y: auto; font-size: 13px; }
        .log-entry { border-bottom: 1px solid #232a3d; padding: 5px 0; display: flex; justify-content: space-between; }
        .alert-active { animation: pulse-red 1.5s infinite; border-color: var(--crit); }
        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(255, 75, 43, 0.4); } 70% { box-shadow: 0 0 0 15px rgba(255, 75, 43, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 75, 43, 0); } }
    </style>
</head>
<body>

<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
    <h2>WELLHEAD ASSET MONITORING <span style="color:var(--accent)">[KAZ-URALS-001]</span></h2>
    <div>
        <span class="status-badge status-ok">LoRa Link: Active</span>
        <span class="status-badge" style="background:#1e293b">Node ID: ESP32_PRO_v5</span>
    </div>
</div>

<div class="dashboard-grid">
    <div class="card">
        <div>ДАВЛЕНИЕ (PRESSURE)</div>
        <div class="sensor-val"><span id="pres-val">0.00</span> <small>Bar</small></div>
        <div style="font-size:11px; color:#64748b">Норма: 4.5 - 6.2 Bar</div>
    </div>
    <div class="card" id="leak-card">
        <div>ПРОТЕЧКА (LEAK SENSOR)</div>
        <div class="sensor-val" id="leak-status">CLEAR</div>
        <div style="font-size:11px; color:#64748b">Датчик: XKC-Y25 (Non-contact)</div>
    </div>
    <div class="card">
        <div>ПОТОК (FLOW RATE)</div>
        <div class="sensor-val"><span id="flow-val">12.4</span> <small>L/min</small></div>
    </div>
    <div class="card">
        <div>КЛАПАН (VALVE STATE)</div>
        <div class="sensor-val" id="valve-val" style="color:#34d399">OPEN</div>
    </div>
</div>

<div class="main-layout">
    <div class="chart-container">
        <canvas id="telemetryChart"></canvas>
    </div>
    <div class="log-container">
        <h4 style="margin-top:0">СИСТЕМНЫЙ ЛОГ (Real-time)</h4>
        <div id="event-log"></div>
    </div>
</div>

<script>
    const ctx = document.getElementById('telemetryChart').getContext('2d');
    let chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [],
            datasets: [{ label: 'Pressure (Bar)', borderColor: '#00d2ff', backgroundColor: 'rgba(0, 210, 255, 0.1)', fill: true, data: [], tension: 0.4 }]
        },
        options: { responsive: true, maintainAspectRatio: false, scales: { y: { grid: { color: '#232a3d' } }, x: { grid: { display: false } } } }
    });

    //
    function processIncomingData() {
        
        let rawPressure = (5 + Math.random() * 1.5).toFixed(2);
        let leakTrigger = Math.random() > 0.95; // 5% шанс симуляции протечки
        
        // Обновление UI
        document.getElementById('pres-val').innerText = rawPressure;
        
        let now = new Date().toLocaleTimeString();
        
        // Логика обработки критической аварии
        if (leakTrigger) {
            document.getElementById('leak-card').classList.add('alert-active');
            document.getElementById('leak-status').innerText = "!!! CRITICAL !!!";
            document.getElementById('leak-status').style.color = "#ff4b2b";
            document.getElementById('valve-val').innerText = "CLOSED";
            document.getElementById('valve-val').style.color = "#ff4b2b";
            addLogEntry(now, "ALARM", "Leak detected! Emergency valve closure executed.");
        }

        
        if(chart.data.labels.length > 15) { chart.data.labels.shift(); chart.data.datasets[0].data.shift(); }
        chart.data.labels.push(now);
        chart.data.datasets[0].data.push(rawPressure);
        chart.update();
    }

    function addLogEntry(time, type, msg) {
        const log = document.getElementById('event-log');
        const entry = document.createElement('div');
        entry.className = 'log-entry';
        entry.innerHTML = `<span>[${time}] <b>${type}:</b> ${msg}</span>`;
        log.prepend(entry);
    }

    setInterval(processIncomingData, 3000);
</script>
</body>
</html>
